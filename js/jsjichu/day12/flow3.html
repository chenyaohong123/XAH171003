<!DOCTYPE html>
<html lang="zh-CN">
<head>
	<meta charset="UTF-8">
	<title>瀑布流复杂版</title>
	<style>
		#list{
			margin: 0  auto;
			position:relative;
		}
		#list img{
			width:200px ;
			position:absolute;
			transition: left 2s, top 1s;

			
		}
	</style>
</head>
<body>
	<div id="wrap">
		<div id="list">	
		</div>
	</div>
	<script>
		//创建img对象
		var  list  = document.getElementById('list');
		for(i = 0;i<30;i++){
			var newImg = new Image();
			newImg.src = 'img/'+ i +'.jpg';
			list.appendChild(newImg);
		}
		
		//声明一个数组，用来判断最短的一个竖排
		   var  heightArr = [];
		function getColNum(){
			//获取浏览器窗口宽度
			var  windowWidth = document.getElementsByTagName('body')[0].offsetWidth;
			//计算浏览器窗口最多放几个竖排
			var   colNum     = Math.floor(windowWidth/220);
			for(var i = 0; i < colNum; i++){ 
				heightArr.push(0);
			}
			//设置list宽度
			list.style.width = colNum * 220 + 'px';
		}
		getColNum();


		function getMinIndex(){
    		var min;
    		for(var i=0;i<heightArr.length;i++){
            min = min < heightArr[i] ? min : heightArr[i];
    		}
    		var minIndex = heightArr.indexOf(min);
    		return minIndex;
    	}
		getMinIndex();

        function setCss(){
        	//获取所有的img标签
        	var imgs = document.getElementsByTagName('img');
        	for(var i=0;i<imgs.length;i++){
        		var index = getMinIndex();//找最矮竖排
        		//设置img标签的left属性
                imgs[i].style.left = index * 220 + 'px';
                //设置img标签的top属性
                imgs[i].style.top  = heightArr[index] + 'px';
                //获取本次图片的高度，将其更新到heightArr数组
                heightArr[index] += imgs[i].offsetHeight + 20;
        	}
        }
        
        
        //图片未加载完成时，无法获取其高度，需要使用window.onload方法
        window.onload =function(){
        	setCss();	
        }

        //当浏览器窗口发生改变时
        window.onresize = function(){
        	heightArr = [];//清除数组
        	getColNum();//重新计算列
        	setCss();//重新设置位置
        }
	</script>
</body>
</html>