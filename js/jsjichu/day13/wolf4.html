<!DOCTYPE html>
<html lang="zh-CN">
<head>
	<meta charset="UTF-8">
	<title>脚踢灰太狼</title>
	<link rel="stylesheet" href="css/index.css">
</head>
<body>
	<div id="container">
		<!-- 分数 -->
		<div id="score">0</div>
		<!-- 倒计时 -->
		<div id="timing"></div>
		<!-- 开始 -->
		<div id="start">
			<p>开始</p>
			<p>操作说明</p>
		</div>
		<!-- 结束 -->
		<div id="over">
			<p>游戏结束</p>
		</div>
		<!-- 狼 -->
		<div id="wolves"></div>
	</div>
</body>
<script>
	var scoreDiv  = document.querySelector('#score');
	var timingDiv = document.querySelector('#timing');
	var startDiv  = document.querySelector('#start>p');
	var overDiv   = document.querySelector('#over');
	var wolves    = document.querySelector('#wolves');
	var start     = document.querySelector('#start');

	//狼的数组
	var posArr = [
			['98px' ,'115px'],
			['17px' ,'160px'],
			['15px' ,'220px'],
			['30px' ,'293px'],
			['122px','273px'],
			['207px','295px'],
			['200px','211px'],
			['187px','141px'],
			['100px','185px']
		];
    var score  = 0;
    
    //随机函数
    function randomNum(x,y){
        return Math.round(Math.random()*(y - x) + x);
    }
    
    function createWolf(){
        var wolf   = new Image();
        wolf.type  = randomNum(0,100) > 60 ? 'x':'h';
        wolf.index = 0;
        wolf.src   = 'img/'+ wolf.type + wolf.index + '.png';
        
        var indexNum;
        var  bol     = 1;
        while(bol){
        var  allWlof = wolves.children;
        	indexNum = randomNum(0,8);
        for(var i =0;i<allWlof.length;i++){
        	if(allWlof[i].style.left == posArr[indexNum][0] ){
        		break;
        	}
        }
        if(i==allWlof.length){
        	bol = 0;
        }
        }
        wolf.style.left = posArr[indexNum][0];
        wolf.style.top  = posArr[indexNum][1];
        wolves.appendChild(wolf);
        return wolf;
    }

    function wolfFn(){
    	var  wolf  = createWolf();
    	wolf.index = 0;
    	wolf.appearTimer  = setInterval(function(){
    	wolf.index ++;
        wolf.src   = 'img/' + wolf.type + wolf.index + '.png';
        if(wolf.index == 5){
        	clearInterval(wolf.appearTimer);
        wolf.disappearTimer= setInterval(function(){
        	wolf.index --;
        	wolf.src   = 'img/' + wolf.type + wolf.index + '.png';
        if(wolf.index == 0){
        	clearInterval(wolf.disappearTimer);
        	wolf.remove();
        }
        },100);
        }
    	},100);
    	beatWolf(wolf);
    }
    

    function beatWolf(a){
         a.flag = 1;
         a.onclick = function(){
         	if(a.flag){
         		clearInterval(a.appearTimer);
         		clearInterval(a.disappearTimer);
         	a.index = 5;
         	a.beatTimer = setInterval(function(){
         	a.index ++;
         	a.src   = 'img/' + a.type + a.index + '.png';
         	if(a.index == 9){
         		clearInterval(a.beatTimer);
         	    a.remove();
         	}
         	},100);
         	}
         	a.flag = 0;
         	if(a.type == 'h'){
         		score +=10;
         	}
         	if(a.type == 'x'){
         		score -=10;
         	}
         	scoreDiv.innerText = score;
         }
    }

    var createWolfTimer;
    function createWolfByTime(){
    	createWolfTimer = setInterval(function(){
    		wolfFn();
    	},200);
    }
    

    function wolfTiming(){
    	var num = 180;
        var setTimer = setInterval(function(){
        	num -=2;
        timingDiv.style.width = num + 'px';
        if(num == 0){
        	wolves.innerHTML = '';
        	clearInterval(setTimer);
        	clearInterval(createWolfTimer);
        	overDiv.style.display = 'block';
            var newP = document.createElement('p');
            newP.innerText = '重新开始';
            overDiv.appendChild(newP);

            newP.onclick = function(){
            overDiv.style.display = 'none';
            num = 180;
            wolfTiming();
            createWolfByTime();
            score = 0;
            scoreDiv.innerText = 0;
            newP.remove();
            }

        }
        },50); 
    }
    

    startDiv.onclick = function(){
    	start.style.display = 'none';
    	wolfTiming();
    	createWolfByTime();

    }
</script>
</html>