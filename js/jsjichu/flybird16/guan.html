<!DOCTYPE html>
<html>
	<head>
		<meta charset="UTF-8">
		<title>管道创建</title>
		<style>
			#wrap,#pipeWrap{
			width:400px;
			height: 480px;
			}
			#wrap{
				position:relative;
				margin: 0 auto;
				overflow: hidden;
				
			}
			#pipeWrap{
				position: absolute;
				top: 0;
				left: 0;
				background:url(img/bg.jpg) ;
			}
			.pipe{
				width: 62px;
				height:450px ;
				position: absolute;
				top:0;
				left:400px;
			}
			.topItem{
				
				width:100% ;
				position: absolute;
				top:0px;
				background: url(img/up_mod.png);
			}
			.bottomItem{
				
				width:100%;
				position: absolute;
				bottom: 0px;
				background: url(img/down_mod.png);
			}
			.topHead{
				width: 100%;
				height: 60px;
				position: absolute;
				bottom: 0;
				background: url(img/up_pipe.png);
			}
			.bottomHead{
				width: 100%;
				height: 60px;
				position: absolute;
				top: 0;
				background: url(img/down_pipe.png);
			}
			#box{
				width: 39px;
				height:26px;
				background:url(img/bird0.png) ;
				position:absolute;
				left:80px ;
				top:230px;
				z-index: 10;
			}
			#score{
				width:200px;
				height: 100px;
				position: absolute;
				top: 20px;
				left: 50px;
				z-index: 10;
			}
		</style>
	</head>
	<body>
	<div id="wrap">
		<div id="score"></div>
		<div id="box"></div>
		<div id="pipeWrap">
			<div class="pipe">
				<!--<div class="topItem">
					<span class="topHead"></span>		
				</div>
				<div class="bottomItem">
					<span class="bottomHead"></span>
				</div>-->
			</div>
		</div>
	</div>	
	<script>
	var score = 0;
	var scoreDiv = document.querySelector('#score');
	//随机数函数，随机管道的高度
	function randomNum(x,y){
      return Math.floor(Math.random()*(y-x)+x);
	}
	var pipeWrap = document.querySelector('#pipeWrap');
	function createPipe(){
	var onePipe = document.createElement('div');//创建管道	
	onePipe.className = 'pipe';
	var topHeight = randomNum(60,240);//上面管道高度(随机)
	var bottomHeight = 300 - topHeight;//下面管道高度(计算)
	onePipe.innerHTML = '<div class="topItem" style="height:'+topHeight+'px;"><span class="topHead"></span></div><div class="bottomItem" style = "height:'+bottomHeight+'px;" ><span class="bottomHead"></span></div>';
	pipeWrap.appendChild(onePipe);
	
	//每个管道都有自己的left值累减的计时器
	onePipe.leftTimer = setInterval(function(){
		onePipe.style.left = onePipe.offsetLeft - 2 + 'px';
		//根据管道的left值，计算分数的累加
		if(onePipe.offsetLeft==18){
			score += 1;
			 clacScore();
		}
		
		//管道移出时清除
		if(onePipe.offsetLeft == -onePipe.offsetWidth){
			clearInterval(onePipe.leftTimer);//清除计时器
			onePipe.remove();//移除此节点
		}
	},10);
	}
	//每隔一段时间，创建一个管道
	var createPipeTimer = setInterval(function(){
		createPipe();
	},1000)
	
	function clacScore(){
		   var newImg;
		   
			//分数转换成分数数值['2','1','3','4','6']
			var scoreArr = String(score).split('');
			console.log(scoreArr);
			for(var i = 0;i<scoreArr.length;i++){
				newImg = new Image;//创建图片
				newImg.src = 'img/' + scoreArr[i] + '.jpg';//拼接路径
				scoreDiv.appendChild(newImg);
				var newImg2 =newImg.previousSbiling
                scoreDiv.removeChild(newImg2);		
			}
			
		}  
		
	
	
	var box  = document.querySelector('#box');
		var downTimer;
			function birdDown(){
				downTimer = setInterval(function(){
				box.style.top = box.offsetTop + 1 + 'px';
				if(box.offsetTop >= wrap.offsetHeight-box.offsetHeight){
					clearInterval(downTimer);
				}
				},10)
			}
			birdDown();
			var upTimer//小鸟上升计时器
			wrap.onclick = function(){
				var onceUp = 30;
				var nowTop = box.offsetTop;//获取当前的top值
				var endTop = nowTop - onceUp;//计算出一次点击应该到达的位置
				clearInterval(downTimer);//清除向下掉落计时器
				clearInterval(upTimer);
				upTimer= setInterval(function(){
					//top值累减
					box.style.top = box.offsetTop - 1 + 'px';
					if(box.offsetTop == endTop){
						clearInterval(upTimer);
						birdDown();
					}
					if(box.offsetTop<0){
						clearInterval(upTimer);
						box.style.top = 'opx';
						birdDown();
					}
				},10);	
			}
			
			
	</script>
	</body>
</html>
