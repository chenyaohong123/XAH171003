<!DOCTYPE html>
<html>
	<head>
		<meta charset="UTF-8">
		<title>canvas+ 面向对象 +碰壁反弹</title>
		<style type="text/css">
			#myCanvas2{
				background: black;
				display:block;
				margin: 0 auto;
			}
		</style>
	</head>
	<body>
		<canvas id="myCanvas2" width="1000" height="600">
			您的浏览器不支持canvas，赶快更新版本吧!
		</canvas>
	</body>
    <script type="text/javascript">
    	      var mc = document.getElementById('myCanvas2');
		  var ctx= mc.getContext('2d');
		  var minX = 5,maxX = mc.width  - 5;
		  var minY = 5,maxY = mc.height - 5;
		  var minR = 2,maxR = 4;
		  var minV = -4,maxV = 4;
		  //鼠标位置对象
		  var mousePoint = {x:-1,y:-1};
		  function rn(x,y){
		  	return Math.round(Math.random()*(y-x)+x);
		  }
		  //封装球类
		  /*
		   * Ball(): 小球类
		   * x,y 小球圆心坐标
		   * r   小球半径
	 	   * bgColor 小球颜色
		   * vx,vy 水平方向和竖直方向的速度
		   */
		  function Ball(x,y,r,bgColor,vx,vy){
		  	this.x = x;
		  	this.y = y;
		  	this.r = r;
		  	this.bgColor = bgColor;
		  	this.vx = vx;
		  	this.vy = vy;
		  }
		  
		  
		  //Ball的原型方法: 碰壁反弹
		  Ball.prototype.draw = function(){
			//碰壁置负
			if(this.x<this.r || this.x >mc.width-this.r){
				this.vx = -this.vx;
			}
			if(this.y<this.r || this.y>mc.height-this.r ) {
				this.vy = -this.vy;
			}
			//改变圆心位置
			this.x += this.vx;
			this.y += this.vy;
			//绘制
			ctx.beginPath();
			ctx.arc(this.x,this.y,this.r,0,2*Math.PI);
			ctx.fillStyle = this.bgColor;
			ctx.fill();
		}
		  
		  //实例化小球
		  var ballArr = [];
		  function createBall(){
		  	var x = rn(minX,maxX);
		  	var y = rn(minY,maxY);
		  	var r = rn(minR,maxR);
		  	var bgColor = 'rgba('+rn(30,255)+','+rn(30,255)+','+rn(30,255)+',0.8)';
//		  	var bgColor = 'blue';
		  	var vx = rn(minV,maxV);
		  	var vy = rn(minV,maxV);
		  	if(vx==0){vx+=1}
		  	if(vy == 0){vy -=1}  	
		  	var newBall = new Ball(x,y,r,bgColor,vx,vy);
		  	ballArr.push(newBall);

		  }
		  
		  for(var i = 0;i<200;i++){
		  	createBall();
		  }
		  console.log(ballArr);
		  setInterval(function(){
		  	ctx.clearRect(0,0,1000,600);
		  	for(var i=0;i<ballArr.length;i++){		  		
		  		ballArr[i].draw();
		  	}
		  	//获取离鼠标最近的小球
		  	var closeArr = getCloseMouseBall();
		  	//画线 （画线对象，每次被更新的closeArr数组）
		  	drawLine(closeArr);
		  },30);
		  
	      //为canvas绑定鼠标移动事件
	      mc.onmousemove = function(){
	      	var e = event || window.event;
	      	var mouseX = e.clientX - mc.offsetLeft;
	      	var mouseY = e.clientY - mc.offsetTop;
	      	 mousePoint = {
	      	 	x:mouseX,
	      	 	y:mouseY
	      	 }
	      }
	      
	      //获取离鼠标规定位置的小球数组
	      function getCloseMouseBall(){
	      	var closeMouseBall = [];
	      	for(var i=0;i<ballArr.length;i++){
	      		//计算距离，满足条件放入新数组
	      		var a   = Math.pow(ballArr[i].x - mousePoint.x,2);
	      		var b   = Math.pow(ballArr[i].y - mousePoint.y,2);
	      		var dis = Math.sqrt(a+b);//距离
	      		if(dis<=150){
	      			closeMouseBall.push(ballArr[i]);
	      		}
	      	}
	      	return closeMouseBall;
	      }
	      
	      //画线
	      function drawLine(arr){
	      	for(var i =0;i<arr.length-1;i++){
	      		for(var j=i+1;j<arr.length;j++){
	      			//ballArr[i],ballArr[j]画线
	      			ctx.beginPath();
	      			ctx.moveTo(arr[i].x,arr[i].y);
	      			ctx.lineTo(arr[j].x,arr[j].y);
	      			ctx.strokeStyle = 'white';
	      			ctx.stroke();
	      		}
	      	}
	      }
    </script>
</html>
