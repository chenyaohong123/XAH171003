<!DOCTYPE html>
<html>
	<head>
		<meta charset="UTF-8">
		<title>canvas+ 面向对象 +碰壁反弹</title>
		<style type="text/css">
			#myCanvas2{
				background: black;
				display:block;
				margin: 0 auto;
			}
		</style>
	</head>
	<body>
		<canvas id="myCanvas2" width="1000" height="600">
			您的浏览器不支持canvas，赶快更新版本吧!
		</canvas>
	</body>
    <script type="text/javascript">
    	      var mc = document.getElementById('myCanvas2');
		  var ctx= mc.getContext('2d');
		  var minX = 5,maxX = mc.width  - 5;
		  var minY = 5,maxY = mc.height - 5;
		  var minR = 2,maxR = 4;
		  var minV = -4,maxV = 4;
		  //鼠标位置对象
		  var mouseObj = {x:-1,y:-1};
		  function rn(x,y){
		  	return Math.round(Math.random()*(y-x)+x);
		  }
		  //封装球类
		  /*
		   * Ball(): 小球类
		   * x,y 小球圆心坐标
		   * r   小球半径
	 	   * bgColor 小球颜色
		   * vx,vy 水平方向和竖直方向的速度
		   */
		  function Ball(x,y,r,bgColor,vx,vy){
		  	this.x = x;
		  	this.y = y;
		  	this.r = r;
		  	this.bgColor = bgColor;
		  	this.vx = vx;
		  	this.vy = vy;
		  }
		  
		  
		  //Ball的原型方法: 碰壁反弹
		  Ball.prototype.draw = function(){
			//碰壁置负
			if(this.x<this.r || this.x >mc.width-this.r){
				this.vx = -this.vx;
			}
			if(this.y<this.r || this.y>mc.height-this.r ) {
				this.vy = -this.vy;
			}
			//改变圆心位置
			this.x += this.vx;
			this.y += this.vy;
			//绘制
			ctx.beginPath();
			ctx.arc(this.x,this.y,this.r,0,2*Math.PI);
			ctx.fillStyle = this.bgColor;
			ctx.fill();
		}
		  
		  //实例化小球
		  var ballArr = [];
		  function createBall(){
		  	var x = rn(minX,maxX);
		  	var y = rn(minY,maxY);
		  	var r = rn(minR,maxR);
		  	var bgColor = 'rgba('+rn(30,255)+','+rn(30,255)+','+rn(30,255)+',0.8)';
//		  	var bgColor = 'blue';
		  	var vx = rn(minV,maxV);
		  	var vy = rn(minV,maxV);
		  	if(vx==0){vx+=1}
		  	if(vy == 0){vy -=1}  	
		  	var newBall = new Ball(x,y,r,bgColor,vx,vy);
		  	ballArr.push(newBall);

		  }
		  
		  for(var i = 0;i<200;i++){
		  	createBall();
		  }
		  console.log(ballArr);
		  setInterval(function(){
		  	ctx.clearRect(0,0,1000,600);
		  	for(var i=0;i<ballArr.length;i++){		  		
		  		ballArr[i].draw();
		  	}
		  	jugeTwoBall();
		  	judgeMouse();
		  },30);
		  
		  //分装计算2个点距离的函数
		  function getDis(ball1,ball2){
		  	  //根据位置
		  	  var  dis =Math.sqrt(Math.pow(ball1.x-ball2.x,2)+Math.pow(ball1.y-ball2.y,2));
		      //返回值
		      if(dis <=40){
		      	return true;
		      }
		      else{
		      	return false;
		      }
		     }
		      
		     //两点之间画线的函数、
		     function drawLine(ball1,ball2){
		     	ctx.beginPath();
		     	ctx.moveTo(ball1.x,ball1.y);
		     	ctx.lineTo(ball2.x,ball2.y);
		     	ctx.strokeStyle = 'rgba('+rn(30,255)+','+rn(30,255)+','+rn(30,255)+',0.8)';
		     	ctx.stroke();
		     }
		  //用循环计算两个小球之间的圆心距
		  function jugeTwoBall(){
		  	for(var i=0;i<ballArr.length-1;i++){
		  		for(var j=i+1;j<ballArr.length;j++){
		  			//ballArr[i] , ballArr[j];
		  		var bol = getDis(ballArr[i],ballArr[j]);//返回布尔值
		  		if(bol){
		  			//画线
		  			drawLine(ballArr[i],ballArr[j]);
		  		}
		  		}
		  	}
		  }
		  
		  //为canvas添加鼠标移动事件
		  mc.onmousemove = function(e){
		  	var e = event || window.event;
		  	//获取鼠标基于canvas的坐标
		  	var mouseX = e.clientX - mc.offsetLeft;
		  	var mouseY = e.clientY - mc.offsetTop;
		  	mouseObj ={//为了符合getDis函数和draw函数的逻辑，将鼠标的坐标封装成对象
		  		x:mouseX,
		  		y:mouseY
		  	}				  		  	
		  }
		  mc.onmouseout = function(){
		  	mouseObj = {
		  		x:-1,
		  		y:-1
		  	}
		  }
		  
		  
		  //判断鼠标位置和所有小球位置关系
		  function judgeMouse(){
		  	//用鼠标坐标和所有的小球做距离的运算 getDis
		  	for(var i=0;i<ballArr.length;i++){
		  		var bol = getDis(ballArr[i],mouseObj);
		  		if(bol&&mouseObj.x>0){
		  			drawLine(ballArr[i],mouseObj);
		  		}
		  	}	
		  }
    </script>
</html>
